<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ‹ï¸â€â™€ï¸ é‹å‹•è¨˜éŒ„ Dashboard</title>

  <!-- Chart.js v3.9.1 + datalabels v2.2.0 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

  <!-- CSV è§£æ -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body { font-family: "Segoe UI", Arial, sans-serif; text-align:center; }
    canvas { max-width: 400px; margin: 20px auto; display:block; }
  </style>
</head>
<body>
  <h2>ğŸ‹ï¸â€â™€ï¸ é‹å‹•è¨˜éŒ„ Dashboard</h2>

  <canvas id="aerobicChart"></canvas>
  <canvas id="assignedChart"></canvas>
  <canvas id="strengthChart"></canvas>

  <script>
    let allData = [];

    // è§£æè·‘é€Ÿ "mm:ss" -> ç§’æ•¸
    function parsePace(paceStr) {
      if (!paceStr) return 0;
      const parts = paceStr.split(':').map(Number);
      if (parts.length === 2) return parts[0]*60 + parts[1];
      return +paceStr;
    }

    // è¼‰å…¥ sport.csv
    Papa.parse('sport.csv', {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        allData = results.data.map(r => {
          const paceStr = r["è·‘é€Ÿ"] || "";
          const paceSec = parsePace(paceStr);
          return {
            date: r["æ—¥æœŸ"],
            running: +r["è·‘æ­¥(min)"] || 0,
            weight: +r["è‚ŒåŠ›è¨“ç·´"] || 0,
            ball: +r["çƒé¡(min)"] || 0,
            assigned: +r["æ•™ç·´æŒ‡å®š"] || 0,
            trail: +r["å¥è¡Œ(min)"] || 0,
            yoga: +r["ç‘œä¼½"] || 0,
            other: +r["å…¶ä»–"] || 0,
            speed: paceStr,
            speedSec: paceSec,
            heart_rate: +r["å¿ƒç‡"] || "",
            remark: r["å‚™è¨»"] || ""
          };
        }).filter(d => d.date);

        renderCharts();
      }
    });

    function renderCharts() {
      const labels = allData.map(d => d.date);
      const sums = {
        aerobic: allData.map(d => d.running + d.ball + d.trail + d.yoga + d.other),
        assigned: allData.map(d => d.assigned),
        strength: allData.map(d => d.weight)
      };

      const chartDefs = [
        { id:"aerobicChart", key:"aerobic", color:"#00bcd4", title:"æœ‰æ°§æ´»å‹•" },
        { id:"assignedChart", key:"assigned", color:"#ffc107", title:"æ•™ç·´æŒ‡å®š" },
        { id:"strengthChart", key:"strength", color:"#3f51b5", title:"è‚ŒåŠ›è¨“ç·´" }
      ];

      chartDefs.forEach(({id,key,color,title})=>{
        const ctx = document.getElementById(id);
        new Chart(ctx, {
          type: "bar",
          data: {
            labels,
            datasets: [{
              label: title,
              data: sums[key],
              backgroundColor: color+"99",
              borderColor: color,
              borderWidth: 1
            }]
          },
          plugins: [ChartDataLabels],
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              datalabels: {
                color:'#333',
                anchor:'end',
                align:'top',
                font:{ weight:'bold', size:11 }
              }
            },
            scales: {
              y: { beginAtZero:true },
              x: { grid:{ display:false } }
            }
          }
        });
      });
    }
  </script>
</body>
</html>


